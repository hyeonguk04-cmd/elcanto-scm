<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì „ì²´ ìƒì‚°ì—…ì²´ UIâ†’Firebase ë™ê¸°í™”</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 1400px;
      margin: 30px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 { color: #2563eb; margin-bottom: 10px; }
    .subtitle { color: #666; margin-bottom: 30px; }
    .warning {
      background: #fee2e2;
      border: 1px solid #ef4444;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
      color: #991b1b;
    }
    .step {
      background: #f0f9ff;
      border: 1px solid #3b82f6;
      padding: 20px;
      border-radius: 8px;
      margin: 20px 0;
    }
    .step h3 { margin-top: 0; color: #1e40af; }
    button {
      background: #2563eb;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      margin: 10px 10px 10px 0;
    }
    button:hover { background: #1d4ed8; }
    button:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }
    button.success {
      background: #059669;
    }
    button.success:hover {
      background: #047857;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      font-size: 13px;
    }
    th, td {
      padding: 8px;
      text-align: left;
      border: 1px solid #ddd;
    }
    th {
      background: #f8f9fa;
      font-weight: 600;
      color: #374151;
      position: sticky;
      top: 0;
    }
    .supplier-name {
      font-weight: 600;
      color: #2563eb;
    }
    .mismatch {
      background: #fee2e2;
      font-weight: 600;
    }
    .loading {
      text-align: center;
      padding: 40px;
      color: #6b7280;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      display: none;
    }
    .result.success {
      background: #d1fae5;
      color: #065f46;
      border: 1px solid #10b981;
      display: block;
    }
    .result.error {
      background: #fee2e2;
      color: #991b1b;
      border: 1px solid #ef4444;
      display: block;
    }
    .table-wrapper {
      overflow-x: auto;
      max-height: 600px;
      overflow-y: auto;
    }
    .firebase-value { color: #dc2626; }
    .ui-value { color: #059669; font-weight: 600; }
    pre {
      background: #f3f4f6;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”„ ì „ì²´ ìƒì‚°ì—…ì²´ UIâ†’Firebase ë¦¬ë“œíƒ€ì„ ë™ê¸°í™”</h1>
    <p class="subtitle">ìƒì‚°ì—…ì²´ ê´€ë¦¬ í™”ë©´(UI)ì— í‘œì‹œëœ ë¦¬ë“œíƒ€ì„ì„ Firebaseì— ì •í™•íˆ ë°˜ì˜í•©ë‹ˆë‹¤.</p>

    <div class="warning">
      <strong>âš ï¸ ì¤‘ìš” ê²½ê³ :</strong>
      <ul style="margin: 10px 0 0 20px;">
        <li><strong>ì´ ë„êµ¬ëŠ” Firebaseì˜ ëª¨ë“  ìƒì‚°ì—…ì²´ leadTimesë¥¼ ë®ì–´ì”ë‹ˆë‹¤!</strong></li>
        <li>ì‹¤í–‰ ì „ ë°˜ë“œì‹œ <strong>ìƒì‚°ì—…ì²´ ê´€ë¦¬ í˜ì´ì§€</strong>ì—ì„œ ëª¨ë“  ì—…ì²´ì˜ ë¦¬ë“œíƒ€ì„ì´ ì •í™•í•œì§€ í™•ì¸í•˜ì„¸ìš”!</li>
        <li>UIì— í‘œì‹œëœ ê°’ì´ ì •í™•í•˜ë‹¤ë©´ ì´ ë„êµ¬ë¥¼ ì‹¤í–‰í•˜ì„¸ìš”.</li>
        <li>ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ì‹ ì¤‘í•˜ê²Œ ì‹¤í–‰í•˜ì„¸ìš”!</li>
      </ul>
    </div>

    <div class="step">
      <h3>ğŸ“‹ Step 1: í˜„ì¬ ìƒíƒœ í™•ì¸</h3>
      <p>ëª¨ë“  ìƒì‚°ì—…ì²´ì˜ UI í‘œì‹œê°’ê³¼ Firebase ì €ì¥ê°’ì„ ë¹„êµí•©ë‹ˆë‹¤.</p>
      <button id="checkBtn" onclick="checkAllSuppliers()">ğŸ” ì „ì²´ ìƒì‚°ì—…ì²´ í™•ì¸</button>
    </div>

    <div id="loading" class="loading" style="display: none;">
      <i>â³ ì²˜ë¦¬ ì¤‘...</i>
    </div>

    <div class="table-wrapper">
      <table id="resultTable" style="display: none;">
        <thead>
          <tr>
            <th rowspan="2">ìƒì‚°ì—…ì²´</th>
            <th colspan="2">ìì¬<br>(material)</th>
            <th colspan="2">í•œë„CFM<br>(hando_cfm)</th>
            <th colspan="2">ì œê°‘&ì¡°ë¦½<br>(cutting_upper)</th>
            <th colspan="2">ê³µì¥ì¶œê³ <br>(factory_shipment)</th>
            <th colspan="2">ì„ ì <br>(shipping)</th>
            <th colspan="2">ì…í•­<br>(arrival)</th>
            <th rowspan="2">ì„ ì í•­<br>-ë„ì°©í•­</th>
          </tr>
          <tr>
            <th>UI</th>
            <th>FB</th>
            <th>UI</th>
            <th>FB</th>
            <th>UI</th>
            <th>FB</th>
            <th>UI</th>
            <th>FB</th>
            <th>UI</th>
            <th>FB</th>
            <th>UI</th>
            <th>FB</th>
          </tr>
        </thead>
        <tbody id="resultBody"></tbody>
      </table>
    </div>

    <div class="step" id="step2" style="display: none;">
      <h3>ğŸš€ Step 2: Firebase ì—…ë°ì´íŠ¸ ì‹¤í–‰</h3>
      <p><strong id="mismatchCount">0</strong>ê°œ ìƒì‚°ì—…ì²´ì˜ ë¦¬ë“œíƒ€ì„ì„ UI ê°’ìœ¼ë¡œ ë™ê¸°í™”í•©ë‹ˆë‹¤.</p>
      <button id="syncBtn" onclick="syncAllSuppliers()" class="success">âœ… UI â†’ Firebase ë™ê¸°í™” ì‹¤í–‰</button>
    </div>

    <div id="result" class="result"></div>
  </div>

  <script type="module">
    const firebaseConfig = {
      apiKey: "AIzaSyAT95g8yR6RBuGcf30tXv9NwH0kkEBwn6k",
      authDomain: "elcanto-scm.firebaseapp.com",
      projectId: "elcanto-scm",
      storageBucket: "elcanto-scm.firebasestorage.app",
      messagingSenderId: "1015941864588",
      appId: "1:1015941864588:web:2e1d3f83a30be6ec81e07f"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    window.db = firebase.firestore();

    let suppliersData = [];

    // UIì—ì„œ ìƒì‚°ì—…ì²´ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ì‹¤ì œ UI í‘œì‹œê°’)
    async function fetchUISupplierData() {
      const snapshot = await window.db.collection('suppliers').get();
      const suppliers = [];
      
      snapshot.forEach(doc => {
        const data = doc.data();
        suppliers.push({
          id: doc.id,
          name: data.name || '',
          // UIì— í‘œì‹œë˜ëŠ” ê°’ (ìƒì‚°ì—…ì²´ ê´€ë¦¬ í™”ë©´ì˜ input ê°’)
          ui_leadTimes: data.leadTimes || {}, // ì¼ë‹¨ í˜„ì¬ ê°’ ê°€ì ¸ì˜¤ê¸°
          // Firebaseì— ì‹¤ì œ ì €ì¥ëœ ê°’
          firebase_leadTimes: data.leadTimes || {},
          shippingRoute: data.shippingRoute || ''
        });
      });
      
      return suppliers;
    }

    window.checkAllSuppliers = async function() {
      const btn = document.getElementById('checkBtn');
      const loading = document.getElementById('loading');
      const table = document.getElementById('resultTable');
      const tbody = document.getElementById('resultBody');
      const step2 = document.getElementById('step2');
      const result = document.getElementById('result');
      
      btn.disabled = true;
      loading.style.display = 'block';
      table.style.display = 'none';
      step2.style.display = 'none';
      result.style.display = 'none';
      tbody.innerHTML = '';
      
      try {
        console.log('ğŸ” ì „ì²´ ìƒì‚°ì—…ì²´ ì¡°íšŒ ì‹œì‘...');
        
        suppliersData = await fetchUISupplierData();
        
        if (suppliersData.length === 0) {
          alert('ìƒì‚°ì—…ì²´ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤!');
          return;
        }
        
        console.log(`ğŸ“¦ ì´ ${suppliersData.length}ê°œ ìƒì‚°ì—…ì²´ ë°œê²¬`);
        console.log('ë°ì´í„°:', suppliersData);
        
        suppliersData.sort((a, b) => a.name.localeCompare(b.name));
        
        let mismatchCount = 0;
        
        suppliersData.forEach(supplier => {
          const row = document.createElement('tr');
          
          const ui = supplier.ui_leadTimes;
          const fb = supplier.firebase_leadTimes;
          
          // ë¶ˆì¼ì¹˜ í™•ì¸ (í˜„ì¬ëŠ” UI=Firebaseì´ë¯€ë¡œ ëª¨ë‘ í‘œì‹œ)
          const hasMismatch = false; // ì¼ë‹¨ ëª¨ë‘ í‘œì‹œ
          
          row.innerHTML = `
            <td class="supplier-name">${supplier.name}</td>
            <td class="ui-value">?</td>
            <td class="firebase-value">${fb.material || '-'}</td>
            <td class="ui-value">?</td>
            <td class="firebase-value">${fb.hando_cfm || '-'}</td>
            <td class="ui-value">?</td>
            <td class="firebase-value">${fb.cutting_upper || '-'}</td>
            <td class="ui-value">?</td>
            <td class="firebase-value">${fb.factory_shipment || '-'}</td>
            <td class="ui-value">?</td>
            <td class="firebase-value">${fb.shipping || '-'}</td>
            <td class="ui-value">?</td>
            <td class="firebase-value">${fb.arrival || '-'}</td>
            <td>${supplier.shippingRoute || '-'}</td>
          `;
          
          tbody.appendChild(row);
        });
        
        table.style.display = 'table';
        loading.style.display = 'none';
        btn.textContent = 'âœ… í™•ì¸ ì™„ë£Œ';
        btn.disabled = false;
        
        result.className = 'result error';
        result.innerHTML = `
          <strong>âš ï¸ ì£¼ì˜:</strong><br><br>
          í˜„ì¬ ì´ ë„êµ¬ëŠ” Firebaseì— ì €ì¥ëœ ê°’ë§Œ í‘œì‹œí•©ë‹ˆë‹¤.<br>
          <strong>UI í‘œì‹œê°’ì€ ìƒì‚°ì—…ì²´ ê´€ë¦¬ í˜ì´ì§€ì—ì„œ ì§ì ‘ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤!</strong><br>
          <br>
          <strong>í•´ê²° ë°©ë²•:</strong><br>
          1. ìƒì‚°ì—…ì²´ ê´€ë¦¬ í˜ì´ì§€ ì—´ê¸°<br>
          2. ê° ì—…ì²´ì˜ "ìˆ˜ì •" ë²„íŠ¼ í´ë¦­<br>
          3. í‘œì‹œëœ ë¦¬ë“œíƒ€ì„ê³¼ ìœ„ í‘œì˜ Firebase ê°’ ë¹„êµ<br>
          4. ë¶ˆì¼ì¹˜í•˜ë©´ UIì—ì„œ ì§ì ‘ ìˆ˜ì • í›„ ì €ì¥<br>
          <br>
          <strong>ë˜ëŠ” ì± ì˜¤ë€ì²˜ëŸ¼ ê°œë³„ ìˆ˜ì •:</strong><br>
          - fix-chaoran-leadtimes.html ì‚¬ìš©
        `;
        
        console.log('âœ… ì „ì²´ ìƒì‚°ì—…ì²´ ì¡°íšŒ ì™„ë£Œ!');
        
      } catch (error) {
        console.error('âŒ ì¡°íšŒ ì‹¤íŒ¨:', error);
        alert('ì¡°íšŒ ì‹¤íŒ¨: ' + error.message);
        btn.disabled = false;
        loading.style.display = 'none';
      }
    };
  </script>
</body>
</html>
