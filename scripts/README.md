# Firebase Firestore ë°±ì—…/ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸

## ğŸ“‹ ê°œìš”

Firebase Firestore ë°ì´í„°ë¥¼ JSON í˜•ì‹ìœ¼ë¡œ ë°±ì—…í•˜ê³  ë³µêµ¬í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤.

---

## ğŸš€ ì‚¬ìš©ë²•

### 1ï¸âƒ£ **ì‚¬ì „ ì¤€ë¹„**

#### Firebase Service Account Key ë‹¤ìš´ë¡œë“œ

1. Firebase Console ì ‘ì†
2. í”„ë¡œì íŠ¸ ì„¤ì • â†’ ì„œë¹„ìŠ¤ ê³„ì •
3. "ìƒˆ ë¹„ê³µê°œ í‚¤ ìƒì„±" í´ë¦­
4. ë‹¤ìš´ë¡œë“œí•œ JSON íŒŒì¼ì„ `firebase-service-account.json`ìœ¼ë¡œ ì´ë¦„ ë³€ê²½
5. í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ì €ì¥

```bash
webapp/
â”œâ”€â”€ firebase-service-account.json  â† ì—¬ê¸°!
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ backup.js
â”‚   â”œâ”€â”€ restore.js
â”‚   â””â”€â”€ README.md
â””â”€â”€ backups/
```

âš ï¸ **ì¤‘ìš”: `.gitignore`ì— ì¶”ê°€í•˜ì—¬ Gitì— ì»¤ë°‹ë˜ì§€ ì•Šë„ë¡ í•˜ì„¸ìš”!**

---

### 2ï¸âƒ£ **ë°±ì—… ì‹¤í–‰**

```bash
# ê¸°ë³¸ ë°±ì—…
node scripts/backup.js
```

#### ì¶œë ¥ ì˜ˆì‹œ:
```
ğŸ” Firebase Firestore ë°±ì—… ì‹œì‘

ğŸ“ ë°±ì—… ë””ë ‰í† ë¦¬: /path/to/backups/2025-01-07_14-30-00

ğŸ“¦ ë°±ì—… ì‹œì‘: orders
âœ… orders: 2ê±´ ë°±ì—… ì™„ë£Œ
ğŸ“¦ ë°±ì—… ì‹œì‘: suppliers
âœ… suppliers: 5ê±´ ë°±ì—… ì™„ë£Œ
ğŸ“¦ ë°±ì—… ì‹œì‘: users
âœ… users: 3ê±´ ë°±ì—… ì™„ë£Œ
ğŸ“¦ ë°±ì—… ì‹œì‘: processes
âœ… processes: 0ê±´ ë°±ì—… ì™„ë£Œ

ğŸ“Š ë°±ì—… ë©”íƒ€ë°ì´í„°:
   ì‹œê°„: 2025-01-07T14:30:00.000Z
   ì´ ë¬¸ì„œ ìˆ˜: 10ê±´

âœ¨ ë°±ì—… ì™„ë£Œ!

ğŸ“ˆ ìš”ì•½:
   ì„±ê³µ: 4ê°œ ì»¬ë ‰ì…˜
   ì‹¤íŒ¨: 0ê°œ ì»¬ë ‰ì…˜
```

#### ìƒì„±ëœ íŒŒì¼:
```
backups/2025-01-07_14-30-00/
â”œâ”€â”€ orders.json          # ë°œì£¼ ë°ì´í„°
â”œâ”€â”€ suppliers.json       # ìƒì‚°ì—…ì²´ ë°ì´í„°
â”œâ”€â”€ users.json           # ì‚¬ìš©ì ë°ì´í„°
â”œâ”€â”€ processes.json       # ê³µì • ë°ì´í„° (legacy)
â””â”€â”€ metadata.json        # ë°±ì—… ë©”íƒ€ì •ë³´
```

---

### 3ï¸âƒ£ **ë³µêµ¬ ì‹¤í–‰**

#### **ë°©ë²• 1: MERGE ëª¨ë“œ (ê¸°ë³¸, ì•ˆì „)**
ê¸°ì¡´ ë°ì´í„°ì™€ ë³‘í•©. ê°™ì€ IDëŠ” ë°±ì—… ë°ì´í„°ë¡œ ì—…ë°ì´íŠ¸.

```bash
node scripts/restore.js backups/2025-01-07_14-30-00
```

#### **ë°©ë²• 2: FORCE ëª¨ë“œ (ì „ì²´ ì‚­ì œ í›„ ë³µêµ¬)**
âš ï¸ ìœ„í—˜: ê¸°ì¡´ ë°ì´í„°ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ê³  ë°±ì—… ë°ì´í„°ë¡œ êµì²´

```bash
node scripts/restore.js backups/2025-01-07_14-30-00 --force
```

#### **ë°©ë²• 3: DRY RUN (í…ŒìŠ¤íŠ¸)**
ì‹¤ì œ ë³€ê²½ ì—†ì´ ë³µêµ¬ ì‹œë®¬ë ˆì´ì…˜

```bash
node scripts/restore.js backups/2025-01-07_14-30-00 --dry-run
```

#### ì¶œë ¥ ì˜ˆì‹œ:
```
ğŸ” Firebase Firestore ë³µêµ¬ ì‹œì‘

â„¹ï¸  MERGE ëª¨ë“œ: ê¸°ì¡´ ë°ì´í„°ì™€ ë³‘í•©í•©ë‹ˆë‹¤.

ğŸ“Š ë°±ì—… ì •ë³´:
   ë°±ì—… ì‹œê°„: 2025-01-07T14:30:00.000Z
   ì´ ë¬¸ì„œ ìˆ˜: 10ê±´
   ì»¬ë ‰ì…˜: orders, suppliers, users, processes

ğŸ“¦ ë³µêµ¬ ì‹œì‘: orders
âœ… orders: 2ê±´ ë³µêµ¬ ì™„ë£Œ
ğŸ“¦ ë³µêµ¬ ì‹œì‘: suppliers
âœ… suppliers: 5ê±´ ë³µêµ¬ ì™„ë£Œ
ğŸ“¦ ë³µêµ¬ ì‹œì‘: users
âœ… users: 3ê±´ ë³µêµ¬ ì™„ë£Œ
ğŸ“¦ ë³µêµ¬ ì‹œì‘: processes
âœ… processes: 0ê±´ ë³µêµ¬ ì™„ë£Œ

âœ¨ ë³µêµ¬ ì™„ë£Œ!

ğŸ“ˆ ìš”ì•½:
   ì„±ê³µ: 4ê°œ ì»¬ë ‰ì…˜
   ì‹¤íŒ¨: 0ê°œ ì»¬ë ‰ì…˜
   ê±´ë„ˆëœ€: 0ê°œ ì»¬ë ‰ì…˜
```

---

## ğŸ“… **ë°±ì—… ì „ëµ ê¶Œì¥ì‚¬í•­**

### **ê°œë°œ ì‘ì—… ì „ (í•„ìˆ˜)**
```bash
# 1. ë°±ì—… ì‹¤í–‰
node scripts/backup.js

# 2. ê°œë°œ ì‘ì—… ì§„í–‰
git checkout -b feature/new-feature
# ... ì½”ë“œ ìˆ˜ì • ...

# 3. ë¬¸ì œ ë°œìƒ ì‹œ ë³µêµ¬
node scripts/restore.js backups/2025-01-07_14-30-00
```

### **ì •ê¸° ë°±ì—… (ê¶Œì¥)**
ë§¤ì¼ ë˜ëŠ” ë§¤ì£¼ ë°±ì—… ì‹¤í–‰

```bash
# package.jsonì— ìŠ¤í¬ë¦½íŠ¸ ì¶”ê°€
"scripts": {
  "backup": "node scripts/backup.js",
  "restore": "node scripts/restore.js"
}

# ì‹¤í–‰
npm run backup
```

---

## ğŸ—‚ï¸ **ë°±ì—… íŒŒì¼ ê´€ë¦¬**

### **ë°±ì—… ë³´ê´€**
- ìµœê·¼ 7ì¼: ë§¤ì¼ ë°±ì—… ìœ ì§€
- ìµœê·¼ 1ê°œì›”: ë§¤ì£¼ ë°±ì—… ìœ ì§€
- 6ê°œì›” ì´ìƒ: ì›”ë³„ ë°±ì—… ìœ ì§€

### **ì˜¤ë˜ëœ ë°±ì—… ì‚­ì œ**
```bash
# 30ì¼ ì´ìƒëœ ë°±ì—… ì‚­ì œ (ìˆ˜ë™)
find backups/ -type d -mtime +30 -exec rm -rf {} \;
```

### **ë°±ì—… ì••ì¶•**
```bash
# ë°±ì—… ë””ë ‰í† ë¦¬ ì••ì¶•
cd backups
zip -r backup_2025-01-07.zip 2025-01-07_14-30-00/
```

---

## âš ï¸ **ì£¼ì˜ì‚¬í•­**

### **ë³´ì•ˆ**
1. âŒ `firebase-service-account.json`ì„ Gitì— ì»¤ë°‹í•˜ì§€ ë§ˆì„¸ìš”
2. âŒ ë°±ì—… íŒŒì¼ì— ë¯¼ê°í•œ ì •ë³´ê°€ í¬í•¨ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì•ˆì „í•˜ê²Œ ë³´ê´€
3. âœ… `.gitignore`ì— ë‹¤ìŒ ì¶”ê°€:
   ```
   firebase-service-account.json
   backups/
   ```

### **ì„±ëŠ¥**
1. ëŒ€ëŸ‰ ë°ì´í„°(1000ê±´ ì´ìƒ) ë°±ì—… ì‹œ ì‹œê°„ì´ ì†Œìš”ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤
2. ë³µêµ¬ ì‹œ Firestore ì“°ê¸° ì œí•œ(500ê°œ/batch)ì„ ìë™ ì²˜ë¦¬í•©ë‹ˆë‹¤

### **ë¹„ìš©**
1. ë°±ì—…: Firestore ì½ê¸° ë¹„ìš© ë°œìƒ (ë¬¸ì„œ ìˆ˜ë§Œí¼)
2. ë³µêµ¬: Firestore ì“°ê¸° ë¹„ìš© ë°œìƒ (ë¬¸ì„œ ìˆ˜ë§Œí¼)
3. ë¬´ë£Œ í• ë‹¹ëŸ‰: ì½ê¸° 50K/ì¼, ì“°ê¸° 20K/ì¼

---

## ğŸ†˜ **ë¬¸ì œ í•´ê²°**

### **ì˜¤ë¥˜: Cannot find module 'firebase-admin'**
```bash
npm install firebase-admin
```

### **ì˜¤ë¥˜: firebase-service-account.json not found**
1. Firebase Consoleì—ì„œ ì„œë¹„ìŠ¤ ê³„ì • í‚¤ ë‹¤ìš´ë¡œë“œ
2. íŒŒì¼ëª…ì„ `firebase-service-account.json`ìœ¼ë¡œ ë³€ê²½
3. í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ì €ì¥

### **ì˜¤ë¥˜: Permission denied**
Service Accountì— Firestore ì½ê¸°/ì“°ê¸° ê¶Œí•œ í•„ìš”
1. Firebase Console â†’ í”„ë¡œì íŠ¸ ì„¤ì • â†’ ì„œë¹„ìŠ¤ ê³„ì •
2. ê¶Œí•œ í™•ì¸: "Cloud Firestore ì‚¬ìš©ì" ì—­í•  í•„ìš”

---

## ğŸ“ **ì§€ì›**

ë¬¸ì œê°€ ìˆìœ¼ë©´ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:
1. Node.js ë²„ì „ (v14 ì´ìƒ ê¶Œì¥)
2. Firebase í”„ë¡œì íŠ¸ ì„¤ì •
3. ì„œë¹„ìŠ¤ ê³„ì • ê¶Œí•œ
4. ë„¤íŠ¸ì›Œí¬ ì—°ê²°

---

## ğŸ“ **ë³€ê²½ ì´ë ¥**

- 2025-01-07: ì´ˆê¸° ë²„ì „ ìƒì„±
  - ë°±ì—… ìŠ¤í¬ë¦½íŠ¸ (backup.js)
  - ë³µêµ¬ ìŠ¤í¬ë¦½íŠ¸ (restore.js)
  - ë¬¸ì„œí™” (README.md)
